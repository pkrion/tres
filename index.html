<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POS Lucasur</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="brand">
      <div class="brand-mark">L</div>
      <div>
        <p class="eyebrow">Ferretería Lucasur</p>
        <h1>Point of Sale</h1>
      </div>
    </div>
    <div class="session">
      <div id="sessionStatus" class="status closed">Caja cerrada</div>
      <div class="session-actions">
        <input type="number" id="openingCash" placeholder="Efectivo inicial">
        <button id="openSession">Abrir caja</button>
        <button class="danger" id="closeSession">Cerrar caja</button>
      </div>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="ventas">Ventas</button>
    <button class="tab" data-tab="productos">Productos</button>
    <button class="tab" data-tab="configuracion">Configuración</button>
    <button class="tab" data-tab="caja">Caja e historial</button>
  </nav>

  <main>
    <section class="tab-panel active" data-section="ventas">
      <div class="section-head">
        <div>
          <p class="eyebrow">Cobro ágil</p>
          <h2>Venta rápida</h2>
          <p class="muted">Pensado para pistola de códigos y teclado: escribe o escanea y presiona Enter para añadir el primer resultado.</p>
        </div>
        <div class="pill">IVA por ticket</div>
      </div>
      <div class="card">
        <div class="input-row responsive">
          <label class="input-block">
            <span>Buscar por referencia / descripción / código de barras</span>
            <input id="search" placeholder="Ej. tornillo, 8437000000000" autocomplete="off">
          </label>
          <button id="addManual" class="ghost">Añadir manual</button>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>Ref</th><th>Descripción</th><th>Cant.</th><th>Precio</th><th>DTO%</th><th>Total</th><th></th></tr>
            </thead>
            <tbody id="saleLines"></tbody>
          </table>
        </div>
        <div class="totals">
          <label class="input-block small-block">
            <span>IVA aplicado (%)</span>
            <input id="vatRate" type="number" step="0.1" value="21">
          </label>
          <div class="totals-numbers">
            <div>Base: <span id="baseValue">0.00</span> €</div>
            <div>IVA: <span id="taxValue">0.00</span> €</div>
            <div>Total: <strong id="totalValue">0.00</strong> €</div>
          </div>
          <button id="chargeBtn" class="primary">Cobrar / Imprimir</button>
        </div>
      </div>
    </section>

    <section class="tab-panel" data-section="productos">
      <div class="section-head">
        <div>
          <p class="eyebrow">Altas masivas</p>
          <h2>Importar productos</h2>
          <p class="muted">Sube un CSV, asigna columnas y revisa las primeras filas antes de importar.</p>
        </div>
        <div class="hint">Referencia, descripción, código de barras y precio son obligatorios.</div>
      </div>
      <div class="card">
        <div class="upload">
          <input type="file" id="csvInput" accept=".csv,text/csv">
          <p class="muted">Arrastra el CSV o haz clic para elegir archivo.</p>
        </div>
        <div id="mappingArea" class="mapping" style="display:none;">
          <h3>Mapea las columnas</h3>
          <div class="input-row responsive">
            <label class="input-block">Referencia<select id="mapReference"></select></label>
            <label class="input-block">Descripción<select id="mapDescription"></select></label>
          </div>
          <div class="input-row responsive">
            <label class="input-block">Código de barras<select id="mapBarcode"></select></label>
            <label class="input-block">Precio venta<select id="mapPrice"></select></label>
          </div>
          <button id="importBtn" class="primary">Importar productos</button>
        </div>
        <div class="table-wrapper soft">
          <table>
            <thead><tr><th>Referencia</th><th>Descripción</th><th>Barcode</th><th>Precio</th></tr></thead>
            <tbody id="productsPreview"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="tab-panel" data-section="configuracion">
      <div class="section-head">
        <div>
          <p class="eyebrow">Preferencias locales</p>
          <h2>Configuración</h2>
          <p class="muted">Plantilla de ticket editable, recordatorio de impresora térmica y rutas de exportación/limpieza.</p>
        </div>
        <div class="hint">Los datos se guardan en SQLite local.</div>
      </div>
      <div class="card settings">
        <div class="input-row responsive">
          <label class="input-block">Nombre/alias de impresora<input id="printerName" placeholder="Ej. EPSON TM-T20"></label>
          <label class="input-block">Ruta de exportación<input id="exportPath" placeholder="exports"></label>
        </div>
        <div class="input-row responsive">
          <label class="input-block small-block">IVA por defecto (%)<input id="defaultVat" type="number" step="0.1" value="21"></label>
          <label class="input-block">Cabecera del ticket<textarea id="ticketHeader" placeholder="Lucasur\nAv. ..."></textarea></label>
          <label class="input-block">Pie del ticket<textarea id="ticketFooter" placeholder="Gracias por su compra"></textarea></label>
        </div>
        <div class="actions">
          <button id="saveSettings" class="primary">Guardar configuración</button>
          <p class="muted">La impresora real se elige en el diálogo de impresión del sistema; guarda el alias para recordar la térmica USB configurada.</p>
        </div>
      </div>
    </section>

    <section class="tab-panel" data-section="caja">
      <div class="section-head">
        <div>
          <p class="eyebrow">Control y limpieza</p>
          <h2>Cierres e historial</h2>
          <p class="muted">Exporta ventas por referencia al cerrar caja, imprime ticket con desglose e higieniza datos por rango.</p>
        </div>
      </div>
      <div class="card">
        <div class="row-split">
          <div>
            <h3>Cierre de caja</h3>
            <p class="muted">Cuando cierres, se pedirá exportar CSV y se imprime ticket resumen.</p>
            <button id="closeSessionPanel" class="primary ghost" disabled>Cerrar caja desde aquí</button>
            <p class="muted small">Usa también los botones rápidos del encabezado.</p>
          </div>
          <div class="divider"></div>
          <div>
            <h3>Historial y limpieza</h3>
            <div class="input-row responsive">
              <label class="input-block">Desde<input type="date" id="fromDate"></label>
              <label class="input-block">Hasta<input type="date" id="toDate"></label>
            </div>
            <button class="secondary" id="clearHistory">Borrar ventas entre fechas</button>
            <p class="muted small">Ideal para purgar por día o mes y mantener la base ligera.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div class="modal" id="ticketModal">
    <div class="modal-content">
      <h3>Ticket listo</h3>
      <div class="ticket-preview" id="ticketPreview"></div>
      <div class="footer-links">
        <button id="printTicket">Imprimir</button>
        <button class="secondary" id="closeModal">Cerrar</button>
      </div>
    </div>
  </div>

  <div class="modal" id="closingModal">
    <div class="modal-content">
      <h3>Cierre de caja</h3>
      <div class="ticket-preview" id="closingPreview"></div>
      <div class="footer-links">
        <button id="downloadCsv">Descargar CSV</button>
        <button id="printClosing">Imprimir ticket</button>
        <button class="secondary" id="closeClosing">Cerrar</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
